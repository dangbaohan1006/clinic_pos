# Family Clinic POS & Inventory System
**Technical Design Document**

**Author:** Senior AI Data Engineer
**Status:** Draft / Implementation Ready
**Budget:** $0 (Free Tier Optimization)

---

## 1. Executive Summary

### Vấn đề (Problem)
Hệ thống hiện tại gặp vấn đề mất đồng bộ dữ liệu giữa hai khâu:
1.  **Dược sĩ (Inventory):** Nhập kho, định giá.
2.  **Bác sĩ (Sales/POS):** Kê đơn, tính tiền.
**Hậu quả:** Bác sĩ thường xuyên quên giá, tính nhầm tiền, dẫn đến thất thoát doanh thu (Revenue Leakage) và khó kiểm soát tồn kho thực tế.

### Giải pháp (Solution)
Xây dựng Web Application nội bộ với kiến trúc **Serverless**, tập trung vào **Data Integrity** (Tính toàn vẹn dữ liệu) và **Low Latency** (Độ trễ thấp).
- **Dược sĩ:** Có giao diện quản lý kho, cập nhật giá/số lượng real-time.
- **Bác sĩ:** Có giao diện POS tìm kiếm thuốc, tự động tính tiền và trừ kho tự động.

---

## 2. System Architecture

Hệ thống được thiết kế theo tiêu chí: **Zero Cost**, **Minimalist**, và **Scalable**.

| Component | Technology | Role |
| :--- | :--- | :--- |
| **Frontend & Hosting** | **Next.js 14+ (App Router)** | Framework React hiện đại, host trên **Vercel**. Tận dụng Server Components để load nhanh. |
| **Database** | **Supabase (PostgreSQL)** | Backend-as-a-Service. Cung cấp Database quan hệ mạnh mẽ, Real-time subscriptions và API tự động. |
| **UI Framework** | **Tailwind CSS + shadcn/ui** | Tối giản, nhẹ (zero-runtime overhead), dễ tùy biến ("vibe code"). |
| **State Management** | **Zustand** | Quản lý trạng thái giỏ hàng (Cart) phía Client nhẹ nhàng hơn Redux. |

---

## 3. Database Engineering (Schema Design)

Chạy các lệnh SQL sau trong **Supabase SQL Editor** để khởi tạo cấu trúc dữ liệu.

### 3.1. Tables Definition

```sql
-- 1. Bảng danh mục thuốc (Inventory)
-- Single Source of Truth cho giá và số lượng
CREATE TABLE medicines (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name TEXT NOT NULL,          -- Tên thuốc
    unit TEXT NOT NULL,          -- Đơn vị (viên, vỉ, hộp)
    price DECIMAL(10, 2) NOT NULL, -- Giá bán
    quantity INTEGER NOT NULL DEFAULT 0, -- Số lượng tồn kho
    active BOOLEAN DEFAULT TRUE, -- Trạng thái kinh doanh
    created_at TIMESTAMP WITH TIME ZONE DEFAULT timezone('utc'::text, now()) NOT NULL,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT timezone('utc'::text, now()) NOT NULL
);

-- 2. Bảng lịch sử giao dịch (Transactions)
-- Lưu vết để đối soát doanh thu cuối ngày
CREATE TABLE transactions (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    total_amount DECIMAL(10, 2) NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT timezone('utc'::text, now()) NOT NULL,
    items JSONB NOT NULL -- Snapshot dữ liệu thuốc tại thời điểm bán
);

-- 3. Indexing (Search Optimization)
CREATE INDEX idx_medicines_name ON medicines USING btree (name);